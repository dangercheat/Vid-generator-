<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/gh/gzuidhof/coi-serviceworker@latest/coi-serviceworker.min.js"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        body { background: #000; color: #ff0055; font-family: monospace; text-align: center; padding: 20px; }
        .box { border: 2px solid #ff0055; padding: 20px; border-radius: 15px; background: #0a0a0a; }
        button { background: #ff0055; color: #fff; padding: 15px; width: 100%; border: none; font-weight: bold; margin-top: 10px; cursor: pointer; }
        #count { font-size: 40px; margin: 10px 0; color: #fff; }
    </style>
</head>
<body>

<div class="box">
    <h2>YT SHORTS GEN</h2>
    <input type="file" id="v" accept="video/mp4" style="width:100%"><br><br>
    <input type="file" id="a" accept="video/mp4" style="width:100%"><br>
    
    <div id="count">0</div>
    <p id="status">Ready for YouTube Edit</p>
    
    <button id="go">GENERATE 9:16 SHORT</button>
</div>

<script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });

    ffmpeg.setLogger(({ message }) => {
        const frameMatch = message.match(/frame=\s*(\d+)/);
        if (frameMatch) document.getElementById('count').innerText = frameMatch[1];
    });

    document.getElementById('go').onclick = async () => {
        const status = document.getElementById('status');
        if (!ffmpeg.isLoaded()) {
            status.innerText = "Starting Engine...";
            await ffmpeg.load();
        }
        
        status.innerText = "Uploading to RAM...";
        ffmpeg.FS('writeFile', 'v.mp4', await fetchFile(document.getElementById('v').files[0]));
        ffmpeg.FS('writeFile', 'a.mp4', await fetchFile(document.getElementById('a').files[0]));

        status.innerText = "Cropping to 9:16 Vertical...";
        
        // This command crops the center and scales for YouTube Shorts
        await ffmpeg.run(
            '-i', 'v.mp4', 
            '-i', 'a.mp4',
            '-t', '15',
            '-filter_complex', 
            "[0:v]scale=-1:1920,crop=1080:1920[v]", 
            '-map', '[v]', '-map', '1:a', 
            '-c:v', 'libx264', '-preset', 'ultrafast', 'short.mp4'
        );

        const data = ffmpeg.FS('readFile', 'short.mp4');
        const url = URL.createObjectURL(new Blob([data.buffer], {type: 'video/mp4'}));
        const link = document.createElement('a');
        link.href = url; link.download = "YT_Short.mp4"; link.innerText = "DOWNLOAD SHORT";
        link.style.color = "#00ffcc";
        document.body.appendChild(link);
        status.innerText = "COMPLETED!";
    };
</script>
</body>
</html>
